---
title: "Coursera - Reproducible Research - Peer Assessment 1"

date: "Wednesday, May 13, 2015"
output: html_document
---
    
```{r, echo = FALSE}
options(scipen=999)
```
    
1. Load, read and store the data:

```{r}
setInternet2(use = TRUE)
dataset_url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
download.file(dataset_url,"activity.zip")
unzip("activity.zip",exdir = getwd())
results <- read.csv("activity.csv")
```

2. Calculate the total number of steps taken per day and plot a histogram:

```{r, message=F, cache=TRUE}
library(dplyr)
groupdata<-group_by(results,date)
daily_steps<-summarize(groupdata,steps=sum(steps, na.rm=TRUE))
hist(daily_steps$steps,col="blue", xlab="# of steps", main="Total daily steps",
           breaks=10, xaxp=c(0,24000,6),yaxp=c(0,16,8))
```


Plot shows a lot of days with <2000 steps (<20 minutes of walking). Either a very sedentary person or a data issue. Lets investigate:
```{r}
daily_steps$steps
summary(daily_steps)
summary(daily_steps$steps)
```

The reason I chose to display results of both `summary(daily_steps)` and `summary(daily_steps$steps)` commands is puzzling errors in the latter - it shows **wrong median value** (10400 instead of 10395) and **wrong maximum value** (21190 instead of 21194) for daily steps. I have no explanation to this. Lesson learned - be careful with `summary()` function. 


So correct (or so we think until we get to part 4) mean daily number of steps is `r round(mean(daily_steps$steps, na.rm=TRUE))` and median is `r median(daily_steps$steps, na.rm=TRUE)`. Quite a few zeros show up in `daily_steps$steps`. To be explained in part 4. 

3. Let's look at average daily activity pattern:

```{r, message=F}
library(dplyr)
groupdata<-group_by(results,interval)
interval_average<-summarize(groupdata,steps=mean(steps, na.rm=TRUE))
plot(interval_average$interval,interval_average$steps,type="l",xaxp=c(0,2400,24))
```

Looks like a daily morning walk (run would have interval steps in 300-500 range). Let's zoom in on 8:00-9:00 period (we know that each hour generates 12 data points):

```{r}
plot(interval_average$interval[97:107],interval_average$steps[97:107],xaxp=c(800,855,11), type="S")
```

And the winner is...

```{r}
interval_average$steps[interval_average$interval=="835"]
```

08:30-08:35 time slot.


As a quick check: `sum(interval_average$steps, na.rm=TRUE)` should be equal to `mean(daily_steps$steps, na.rm=TRUE)`. Averaging by intervals across dates first and then summing should give the same result for average daily steps as summing by intervals for each date first and then averaging across dates. 


Alas:

```{r}
sum(interval_average$steps, na.rm=TRUE)
mean(daily_steps$steps, na.rm=TRUE)
```


Something is clearly wrong. The answer follows in part 4.  


4. Now lets deal with those suspicious zeros in daily steps data. 
   
```{r}
summary(results$steps)
emptydata <- results[is.na(results$steps),]
summary(emptydata,maxsum=10)
```

So now we have an explanation of that <2000 steps/day spike in the histogram - there are 8 full days of NAs in the data, 2304 in total (those days showed up as zeros in the histogram). Data for the remaining 53 days is complete with no NAs. Lets fill those empty days with average daily interval data stored in `interval_average$steps`

```{r}
replacement.data <- rep(interval_average$steps,8)
filled.results <- results
filled.results$steps[is.na(results$steps)] <- replacement.data
```

Let's look at histogram and summary data again. We know what to expect - 8 days should be moved from a <2000 bin to a [8000:10000] bin. The question is why those days were in <2000 bin to start with?


```{r}
groupdata<-group_by(filled.results,date)
filled_daily_steps<-summarize(groupdata,steps=sum(steps, na.rm=TRUE))
hist(filled_daily_steps$steps,col="blue", xlab="# of steps", main="Total daily steps", breaks=10, xaxp=c(0,24000,6),yaxp=c(0,24,12))
```

Makes sense. How about mean/median? `r round(mean(filled_daily_steps$steps))` and 
`r round(median(filled_daily_steps$steps))`. Our NA replacement method clearly should not have changed the mean. 


Now that we know that 8 full days of data were missing, lets look again at `daily_steps$steps` output in part 2. Those 8 zero entries in `daily_steps$steps` were generated by `daily_steps<-summarize(groupdata,steps=sum(steps, na.rm=TRUE))` command. Somehow, summing up 288 of NAs for those 8 days with missing data in `steps=sum(steps, na.rm=TRUE)` argument in `summarize()` function **yielded zeros instead of NAs**. So when calculating average daily steps from `daily_steps$steps` data, 8 zeros were included in calculation instead of being properly omitted as NAs. Indeed, if one multiplies `mean(daily_steps$steps, na.rm=TRUE)` (=`r round(mean(daily_steps$steps, na.rm=TRUE))`) by `61/53` to correct for that issue (53 instead of 61 days should be used in averaging), one recovers correct mean as we calculated via `sum(interval_average$steps, na.rm=TRUE)`: `r round(mean(daily_steps$steps, na.rm=TRUE)*61/53)`


Issue closed. 


Let's look at weekend effect:

5. Add a weekend flag to `filled.results` and split data into weekend and weekday:

```{r}
filled.results$weekend <- weekdays(as.Date(filled.results$date)) %in% c("Saturday","Sunday")
weekend_results<-filled.results[filled.results$weekend,]
weekday_results<-filled.results[!filled.results$weekend,]
```

Lets compare intraday plots of average number of steps taken as a function of time interval:

```{r}
groupdata.weekend<-group_by(weekend_results,interval)
groupdata.weekday<-group_by(weekday_results,interval)
weekend_interval_average<-summarize(groupdata.weekend,steps=mean(steps, na.rm=TRUE))
weekday_interval_average<-summarize(groupdata.weekday,steps=mean(steps, na.rm=TRUE))
mar <- par("mar"); mar[c(2, 4)] <- 0
par(mfrow=c(1,2), mar=mar)
plot(weekend_interval_average$interval,weekend_interval_average$steps,type="l",xaxp=c(0,2400,6), xlab="",main="Weekend",ylab="Weekend # of Steps", cex.axis=0.6)
plot(weekday_interval_average$interval,weekday_interval_average$steps,type="l",xaxp=c(0,2400,6), xlab="",main="Weekday",ylab="Weekday # of Steps", cex.axis=0.6)
```

So looks like there is more running around on weekends during the day, as expected. The person is early raiser on weekends and hits the bed by 10pm - not much difference from weekday schedule. Also, morning walks continue on weekends - so it is perhaps an exercise and not part of a weekday morning commute.  







